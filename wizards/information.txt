this code is borrowed from django merlin project.